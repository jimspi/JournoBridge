<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Job Decoder</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen p-6">
  <header class="text-center mb-8">
    <h1 class="text-3xl font-bold text-teal-300">Job Decoder</h1>
    <p class="text-gray-400">Paste any job description and we’ll decode it: alignment score, missing elements, and how to prep.</p>
  </header>
  <main class="max-w-3xl mx-auto">
    <textarea id="jobDesc" placeholder="Paste job description here..." class="w-full mb-4 p-3 rounded bg-gray-800 text-white border border-teal-500" rows="6"></textarea>
    <button id="decodeBtn" class="bg-blue-600 border-2 border-blue-300 px-6 py-2 rounded hover:bg-blue-500 mb-4">Decode Job</button>
    <button id="copyBtn" class="bg-teal-500 px-6 py-2 rounded hover:bg-teal-400 mb-4 ml-2 hidden">Copy Results</button>
    <div id="output" class="bg-gray-800 text-white p-4 rounded hidden space-y-4"></div>
  </main>
  <script>
    let lastOutput = '';
    document.getElementById('decodeBtn').onclick = async () => {
      const resume = localStorage.getItem('resumeText');
      const job = document.getElementById('jobDesc').value;
      const output = document.getElementById('output');
      const copyBtn = document.getElementById('copyBtn');

      output.innerHTML = 'Thinking...';
      output.classList.remove('hidden');
      copyBtn.classList.add('hidden');

      try {
        const res = await fetch('/api/gpt', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            prompt: `You're a hiring strategist. Compare the resume below to this job description and respond with:

1. Resume-to-job alignment score (0–100)
2. Strongest matching sections from resume
3. Gaps or weaknesses
4. One specific change to improve resume
5. One smart interview prep tip based on the job

Resume: ${resume}

Job: ${job}`
          })
        });

        const data = await res.json();
        if (data.output) {
          lastOutput = data.output;
          output.innerHTML = data.output.replace(/\n/g, '<br>');
          copyBtn.classList.remove('hidden');
        } else {
          output.innerHTML = '<p class="text-red-500">No output returned. Please try again.</p>';
        }
      } catch (err) {
        output.innerHTML = '<p class="text-red-500">An error occurred. Please try again later.</p>';
        console.error(err);
      }
    };

    document.getElementById('copyBtn').onclick = () => {
      if (!lastOutput) return alert('No results to copy yet.');
      navigator.clipboard.writeText(lastOutput).then(() => {
        alert('Results copied to clipboard!');
      }).catch(err => {
        alert('Failed to copy results.');
        console.error(err);
      });
    };
  </script>
</body>
</html>

